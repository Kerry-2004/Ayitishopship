<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enregistrement de Colis - AyitiShop&Ship</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            color: #1a202c;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: white;
            color: #001b72;
            text-decoration: none;
            border-radius: 0.5rem;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .back-btn:hover {
            background: #001b72;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #001b72;
            margin-bottom: 1rem;
        }

        .page-subtitle {
            font-size: 1.125rem;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto;
        }

        .form-container {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            border: 1px solid #f3f4f6;
        }

        .form-sections {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        @media (min-width: 1024px) {
            .form-sections {
                grid-template-columns: 1fr 1fr;
            }
        }

        .form-section {
            background: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #e5e7eb;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #001b72;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #001b72;
            margin-bottom: 0.5rem;
        }

        .required {
            color: #ea002a;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ea002a;
            box-shadow: 0 0 0 3px rgba(234, 0, 42, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .dimensions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.5rem;
        }

        .photo-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .photo-upload:hover {
            border-color: #ea002a;
            background-color: #fef2f2;
        }

        .photo-upload.dragover {
            border-color: #ea002a;
            background-color: #fef2f2;
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .photo-item {
            position: relative;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .photo-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .photo-remove {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .price-display {
            background: linear-gradient(135deg, #f0f8ff, #e0f2fe);
            border: 2px solid #0ea5e9;
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            margin: 1.5rem 0;
            grid-column: 1 / -1;
        }

        .price-label {
            font-size: 0.875rem;
            color: #0369a1;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .price-amount {
            font-size: 2rem;
            font-weight: 700;
            color: #ea002a;
        }

        .price-details {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }

        .submit-section {
            grid-column: 1 / -1;
            text-align: center;
            margin-top: 2rem;
        }

        .submit-btn {
            background: linear-gradient(135deg, #ea002a, #ff4757);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1.125rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(234, 0, 42, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .info-box {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            grid-column: 1 / -1;
        }

        .info-box h4 {
            color: #ea002a;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .info-box ul {
            color: #6b7280;
            padding-left: 1.5rem;
        }

        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            display: none;
        }

        .success-icon {
            font-size: 3rem;
            color: #10b981;
            margin-bottom: 1rem;
        }

        .tracking-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #001b72;
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            border: 2px dashed #10b981;
            font-family: 'Courier New', monospace;
        }

        .qr-code-section {
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #ea002a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Retour à l'accueil
            </a>
            <h1 class="page-title">Enregistrement de Colis</h1>
            <p class="page-subtitle">
                Système complet d'enregistrement et de suivi des colis AyitiShop&Ship
            </p>
        </div>

        <div class="form-container">
            <form id="colisForm" enctype="multipart/form-data">
                <div class="form-sections">
                    <!-- Section Expéditeur -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-user"></i>
                            Expéditeur (USA)
                        </h3>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="expediteur_nom">Nom complet <span class="required">*</span></label>
                                <input type="text" id="expediteur_nom" name="expediteur[nom_complet]" required>
                            </div>
                            <div class="form-group">
                                <label for="expediteur_telephone">Téléphone <span class="required">*</span></label>
                                <input type="tel" id="expediteur_telephone" name="expediteur[telephone]" required>
                            </div>
                            <div class="form-group">
                                <label for="expediteur_email">Email <span class="required">*</span></label>
                                <input type="email" id="expediteur_email" name="expediteur[email]" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="expediteur_adresse">Adresse complète</label>
                                <textarea id="expediteur_adresse" name="expediteur[adresse_complete]" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="expediteur_ville">Ville</label>
                                <input type="text" id="expediteur_ville" name="expediteur[ville]">
                            </div>
                            <div class="form-group">
                                <label for="expediteur_etat">État</label>
                                <input type="text" id="expediteur_etat" name="expediteur[etat]">
                            </div>
                        </div>
                    </div>

                    <!-- Section Destinataire -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-map-marker-alt"></i>
                            Destinataire (Haïti)
                        </h3>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="destinataire_nom">Nom complet <span class="required">*</span></label>
                                <input type="text" id="destinataire_nom" name="destinataire[nom_complet]" required>
                            </div>
                            <div class="form-group">
                                <label for="destinataire_telephone">Téléphone <span class="required">*</span></label>
                                <input type="tel" id="destinataire_telephone" name="destinataire[telephone]" required>
                            </div>
                            <div class="form-group">
                                <label for="destinataire_email">Email</label>
                                <input type="email" id="destinataire_email" name="destinataire[email]">
                            </div>
                            <div class="form-group full-width">
                                <label for="ville_recuperation">Ville de récupération <span class="required">*</span></label>
                                <select id="ville_recuperation" name="destinataire[ville_recuperation]" required>
                                    <option value="">Sélectionnez une ville</option>
                                    <option value="Port-au-Prince">Port-au-Prince</option>
                                    <option value="Cap-Haïtien">Cap-Haïtien</option>
                                    <option value="Les Cayes">Les Cayes</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label for="destinataire_adresse">Adresse complète</label>
                                <textarea id="destinataire_adresse" name="destinataire[adresse_complete]" rows="2"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Section Colis -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-box"></i>
                            Informations du Colis
                        </h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="type_colis">Type de colis <span class="required">*</span></label>
                                <select id="type_colis" name="colis[type_colis]" required>
                                    <option value="">Sélectionnez le type</option>
                                    <option value="documents">Documents</option>
                                    <option value="vetements">Vêtements</option>
                                    <option value="electronique">Électronique</option>
                                    <option value="alimentaire">Alimentaire</option>
                                    <option value="medicaments">Médicaments</option>
                                    <option value="autres">Autres</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="poids_lbs">Poids (lbs) <span class="required">*</span></label>
                                <input type="number" id="poids_lbs" name="colis[poids_lbs]" step="0.1" min="0.1" required>
                            </div>
                            <div class="form-group full-width">
                                <label>Dimensions (cm)</label>
                                <div class="dimensions-grid">
                                    <input type="number" id="longueur" name="colis[longueur_cm]" placeholder="Longueur" step="0.1">
                                    <input type="number" id="largeur" name="colis[largeur_cm]" placeholder="Largeur" step="0.1">
                                    <input type="number" id="hauteur" name="colis[hauteur_cm]" placeholder="Hauteur" step="0.1">
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label for="description">Description détaillée <span class="required">*</span></label>
                                <textarea id="description" name="colis[description_detaillee]" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="quantite">Quantité d'articles</label>
                                <input type="number" id="quantite" name="colis[quantite_articles]" min="1" value="1">
                            </div>
                            <div class="form-group">
                                <label for="instructions">Instructions spéciales</label>
                                <textarea id="instructions" name="colis[instructions_speciales]" rows="2" placeholder="Fragile, manipuler avec soin..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Section Photos -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-camera"></i>
                            Photos du Colis
                        </h3>
                        <div class="photo-upload" id="photoUpload">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #6b7280; margin-bottom: 1rem;"></i>
                            <p>Cliquez ou glissez-déposez vos photos ici</p>
                            <p style="font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem;">
                                Formats acceptés: JPG, PNG, GIF (max 5MB par photo)
                            </p>
                            <input type="file" id="photos" name="photos[]" multiple accept="image/*" style="display: none;">
                        </div>
                        <div class="photo-preview" id="photoPreview"></div>
                    </div>

                    <!-- Calcul du Prix -->
                    <div class="price-display" id="priceDisplay" style="display: none;">
                        <div class="price-label">Coût estimé de l'expédition</div>
                        <div class="price-amount" id="calculatedPrice">$0.00</div>
                        <div class="price-details" id="priceDetails"></div>
                    </div>

                    <!-- Informations Importantes -->
                    <div class="info-box">
                        <h4><i class="fas fa-info-circle"></i> Informations Importantes</h4>
                        <ul>
                            <li>Tous les champs marqués d'un * sont obligatoires</li>
                            <li>Le poids doit être en livres (lbs)</li>
                            <li>Un numéro de suivi et QR code seront générés automatiquement</li>
                            <li>Le destinataire recevra une notification par SMS/email</li>
                            <li>Les photos aident à identifier le colis en cas de problème</li>
                        </ul>
                    </div>

                    <!-- Bouton de soumission -->
                    <div class="submit-section">
                        <button type="submit" class="submit-btn" id="submitBtn">
                            <i class="fas fa-paper-plane"></i>
                            Enregistrer le Colis
                        </button>
                    </div>
                </div>
            </form>

            <!-- Message de chargement -->
            <div class="loading" id="loadingMessage">
                <div class="spinner"></div>
                <p>Enregistrement du colis en cours...</p>
            </div>

            <!-- Message d'erreur -->
            <div class="error-message" id="errorMessage"></div>

            <!-- Message de succès -->
            <div class="success-message" id="successMessage">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 style="color: #10b981; margin-bottom: 1rem;">Colis Enregistré avec Succès!</h3>
                <p style="color: #6b7280; margin-bottom: 1rem;">
                    Votre colis a été enregistré dans notre système avec les informations suivantes :
                </p>
                <div class="tracking-number" id="generatedTrackingNumber">
                    AYITI-000000
                </div>
                <div class="qr-code-section" id="qrCodeSection">
                    <h4 style="color: #001b72; margin-bottom: 1rem;">Code QR du Colis</h4>
                    <div id="qrCodeDisplay"></div>
                    <button type="button" class="submit-btn" onclick="imprimerQR()" style="margin-top: 1rem;">
                        <i class="fas fa-print"></i>
                        Imprimer le QR Code
                    </button>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 2rem;">
                    <a href="suivi-ameliore.html" class="back-btn">
                        <i class="fas fa-search"></i>
                        Suivre ce Colis
                    </a>
                    <a href="nouveau-envoi-complet.html" class="back-btn">
                        <i class="fas fa-plus"></i>
                        Nouveau Colis
                    </a>
                    <a href="index.html" class="back-btn">
                        <i class="fas fa-home"></i>
                        Retour à l'Accueil
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Inclure la bibliothèque QR Code -->
   <!-- <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>-->
    
    <script>
        // Variables globales
        let selectedPhotos = [];
        let currentTrackingNumber = '';
        let currentQRCode = '';

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initializePhotoUpload();
            initializePriceCalculation();
            initializeFormSubmission();
        });

        // Gestion de l'upload de photos
        function initializePhotoUpload() {
            const photoUpload = document.getElementById('photoUpload');
            const photoInput = document.getElementById('photos');
            const photoPreview = document.getElementById('photoPreview');

            // Clic sur la zone d'upload
            photoUpload.addEventListener('click', () => photoInput.click());

            // Drag & Drop
            photoUpload.addEventListener('dragover', (e) => {
                e.preventDefault();
                photoUpload.classList.add('dragover');
            });

            photoUpload.addEventListener('dragleave', () => {
                photoUpload.classList.remove('dragover');
            });

            photoUpload.addEventListener('drop', (e) => {
                e.preventDefault();
                photoUpload.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            // Sélection de fichiers
            photoInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/') && file.size <= 5 * 1024 * 1024) {
                    selectedPhotos.push(file);
                    displayPhoto(file);
                } else {
                    alert(`Le fichier ${file.name} n'est pas valide (doit être une image < 5MB)`);
                }
            });
        }

        function displayPhoto(file) {
            const photoPreview = document.getElementById('photoPreview');
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item';

            const img = document.createElement('img');
            const reader = new FileReader();
            reader.onload = (e) => img.src = e.target.result;
            reader.readAsDataURL(file);

            const removeBtn = document.createElement('button');
            removeBtn.className = 'photo-remove';
            removeBtn.innerHTML = '×';
            removeBtn.onclick = () => {
                const index = selectedPhotos.indexOf(file);
                if (index > -1) {
                    selectedPhotos.splice(index, 1);
                    photoItem.remove();
                }
            };

            photoItem.appendChild(img);
            photoItem.appendChild(removeBtn);
            photoPreview.appendChild(photoItem);
        }

        // Calcul automatique du prix
        function initializePriceCalculation() {
            const poidsInput = document.getElementById('poids_lbs');
            const villeSelect = document.getElementById('ville_recuperation');

            [poidsInput, villeSelect].forEach(element => {
                element.addEventListener('input', calculatePrice);
                element.addEventListener('change', calculatePrice);
            });
        }

        function calculatePrice() {
            const poids = parseFloat(document.getElementById('poids_lbs').value) || 0;
            const ville = document.getElementById('ville_recuperation').value;
            
            if (poids > 0 && ville) {
                const tarifs = {
                    'Port-au-Prince': 3.5,
                    'Cap-Haïtien': 4.0,
                    'Les Cayes': 6.0
                };
                
                const fraisFixes = 10.0;
                const tarifParLb = tarifs[ville];
                const coutTotal = (poids * tarifParLb) + fraisFixes;
                
                document.getElementById('calculatedPrice').textContent = `$${coutTotal.toFixed(2)}`;
                document.getElementById('priceDetails').textContent = 
                    `${poids} lbs × $${tarifParLb} + $${fraisFixes} frais fixes`;
                document.getElementById('priceDisplay').style.display = 'block';
            } else {
                document.getElementById('priceDisplay').style.display = 'none';
            }
        }

        // Gestion de la soumission du formulaire
        function initializeFormSubmission() {
            document.getElementById('colisForm').addEventListener('submit', handleFormSubmission);
        }

        async function handleFormSubmission(e) {
            e.preventDefault();
            
            const form = e.target;
            const formData = new FormData(form);
            
            // Ajouter les photos
            selectedPhotos.forEach((photo, index) => {
                formData.append(`photos[${index}]`, photo);
            });

            // Afficher le loading
            showLoading();

            try {
                // Simuler l'appel API (remplacer par l'appel réel)
                const response = await simulateAPICall(formData);
                
                if (response.success) {
                    currentTrackingNumber = response.data.numero_suivi;
                    currentQRCode = response.data.qr_code;
                    showSuccess(response.data);
                } else {
                    throw new Error(response.error);
                }
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        // Simulation d'appel API (à remplacer par le vrai appel)
        async function simulateAPICall(formData) {
            // Simulation d'un délai réseau
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Générer des données de test
            const timestamp = Date.now().toString().slice(-6);
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            const numeroSuivi = `AYITI-${timestamp}${random}`;
            const qrCode = `QR-${numeroSuivi}-${Date.now()}`;
            
            const poids = parseFloat(formData.get('colis[poids_lbs]')) || 0;
            const ville = formData.get('destinataire[ville_recuperation]');
            const tarifs = { 'Port-au-Prince': 3.5, 'Cap-Haïtien': 4.0, 'Les Cayes': 6.0 };
            const cout = (poids * (tarifs[ville] || 3.5)) + 10;
            
            return {
                success: true,
                data: {
                    colis_id: Math.floor(Math.random() * 10000),
                    numero_suivi: numeroSuivi,
                    qr_code: qrCode,
                    cout_expedition: cout.toFixed(2),
                    date_prevue_arrivee: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
                }
            };
        }

        // Fonctions d'affichage
        function showLoading() {
            document.getElementById('colisForm').style.display = 'none';
            document.getElementById('loadingMessage').style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loadingMessage').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('colisForm').style.display = 'block';
        }

        function showSuccess(data) {
            document.getElementById('generatedTrackingNumber').textContent = data.numero_suivi;
            
            // Générer le QR Code
            generateQRCode(data.numero_suivi, data.qr_code);
            
            document.getElementById('successMessage').style.display = 'block';
        }

        // Génération du QR Code
       function generateQRCode(trackingNumber) {
    const qrCodeDisplay = document.getElementById('qrCodeDisplay');
    qrCodeDisplay.innerHTML = ''; // vide la div avant de générer un nouveau QR

    if (!trackingNumber) {
        qrCodeDisplay.innerHTML = '<p>Numéro de suivi invalide</p>';
        return;
    }

    // Crée un canvas pour le QR
    const canvas = document.createElement('canvas');
    qrCodeDisplay.appendChild(canvas);

    // Génération du QR code
    QRCode.toCanvas(canvas, trackingNumber, {
        width: 200,
        color: {
            dark: '#001b72',
            light: '#ffffff'
        },
        errorCorrectionLevel: 'H'
    }, function (error) {
        if (error) {
            console.error('Erreur génération QR Code:', error);
            qrCodeDisplay.innerHTML = '<p>Erreur lors de la génération du QR Code</p>';
        }
    });
}


        // Impression du QR Code
        function imprimerQR() {
            const printWindow = window.open('', '_blank');
            const qrCanvas = document.querySelector('#qrCodeDisplay canvas');
            
            if (qrCanvas) {
                const qrDataURL = qrCanvas.toDataURL();
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>QR Code - ${currentTrackingNumber}</title>
                            <style>
                                body { 
                                    font-family: Arial, sans-serif; 
                                    text-align: center; 
                                    padding: 20px; 
                                }
                                .qr-container {
                                    border: 2px solid #001b72;
                                    padding: 20px;
                                    display: inline-block;
                                    margin: 20px;
                                }
                                .tracking-number {
                                    font-size: 18px;
                                    font-weight: bold;
                                    margin: 10px 0;
                                    color: #001b72;
                                }
                            </style>
                        </head>
                        <body>
                            <h1>AyitiShop&Ship</h1>
                            <div class="qr-container">
                                <img src="${qrDataURL}" alt="QR Code">
                                <div class="tracking-number">${currentTrackingNumber}</div>
                            </div>
                            <p>Collez ce QR Code sur votre colis</p>
                        </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }
        }
    </script>
</body>
</html>